<!DOCTYPE html>
<html 
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/defaultLayout}">
<section layout:fragment="content" class="contents d-flex justify-content-center">
	<div>
		<!-- 검색 바탕 -->
		<div class="search-box d-flex">
			<!-- 돋보기 이미지 -->
			<div class="d-flex align-items-center ml-3">
				<img alt="검색" width="35" src="https://cdn.pixabay.com/photo/2022/03/06/06/39/search-7050945_960_720.png">
				<!-- text -->
				<div class="d-flex ml-4">
					<input id="searchUserTextByLoginId" type="text" class="form-control col-12" placeholder="유저 검색">
					<button id="searchBtn" class="form-control bg-warning col-3" >검색</button>
				</div>
			</div>
		</div>
		
		<!-- 유저 조회값 -->
		<div class="search-result-box">
			<div class="ml-3">
				<div>	
					<div class="d-flex justify-content-around" th:each="searchUser : ${searchUserViewList}"> <!-- 여기서 반복문 돌리기 -->
						<!-- 유저 이름 나오게 하기 -->
						<span th:if="${searchUser.user.loginId == session.userLoginId}" th:text="${searchUser.user.loginId}" class="d-none">유저이름</span>
						<span th:unless="${searchUser.user.loginId == session.userLoginId}" th:text="${searchUser.user.loginId}">유저이름</span>
						
						<!-- 상태 표시: 나는 숨겨 -->
						<span th:if="${searchUser.user.loginId == session.userLoginId}" class="status bg-success d-none">나야</span>
						
						<!-- 상태표시 case문 해야 함 팔로우 버튼 누르면 팔로우 Controller로 넘어가게 설계 후 API 설계 -->
						<a href="#"><span id="follow" th:unless="${searchUser.user.loginId == session.userLoginId}" class="status bg-primary">팔로우</span></a> 
					</div>
				</div>
			</div>
		</div>
	</div>
</section>

<th:block layout:fragment="script">
    <script>
		$(document).ready(function() {
			//alert("응");
			
			// 검색버튼
			$("#searchBtn").on('click', function() {
				// 이름, 상태 초기화
				
				let loginId = $("#searchUserTextByLoginId").val().trim();
				console.log(loginId);
				if (!loginId) {
					alert("찾을 유저를 입력하세요");
					return;
				}
				
				location.href = "/search/user-view?keyword=" + loginId; 
				
				
				/*
				
				// 폼 태그를 스크립트에서 쓰기
				let formData = new FormData();
				formData.append("loginId", loginId);
				
				//AJAX 시작
				$.ajax({
					type:"Post"
					, url:"/search/result-view"
					, data: formData
					, contentType: false
					, processData: false
					, success:function(data) {
						if (data.code == 200) {
							alert(data.result);
							console.log(data.list);
							
						} else if (data.code == 500){ // 비로그인시 화면 이동
							alert(data.error_message);
							location.href="/user/sign-in-view";
						} else if (data.code == 403) { // 유저 없을 때 메시지
							alert(data.non_user);
							location.reload();
						}
					}
					, error:function(e) {
						alert("유저를 검색하는데 실패했습니다.");
					}
				}); // AJAX 끝
				*/
				
			}); // 검색버튼 끝
		}); // document 끝
    </script>
</th:block>